FROM openshift/base-centos7

# https://docs.docker.com/engine/reference/builder/#env
# https://docs.docker.com/engine/reference/builder/#environment-replacement
ENV R3=8087
ENV R2="$R3"
ENV R1=$R2
ENV PORT 8080
ENV X=8084 RANGE=8085-8086 RECURSIVE="$R1"
ARG ARG_PORT=8090
ENV BRACES=8091
ENV LINE=8092
ENV LINE=8093 LINE2="${LINE}"
ENV OVERLAP=8092-8095
ENV DEFAULT="${MISSING:-8093}"
ENV OVERRIDE="${DEFAULT:+8094}"
ENV MISSING_OVERRIDE="${MISSING:+8094}"
ENV PORT_P 8100
ENV RANGE_P 8101-8105
ENV PROTO udp
ENV EARLY_EXPOSE 8060
ENV EARLY_EXPOSE2 8059
ENV REDEFINE 8050
ENV REDEFINE 8051

#        8058/UDP    8051
EXPOSE 8058/$PROTO $REDEFINE

ENV REDEFINE 8052
#          8059            8060       8052
EXPOSE $EARLY_EXPOSE2 $EARLY_EXPOSE $REDEFINE

ADD run.sh .

ENV REDEFINE 8053
ENV EARLY_EXPOSE=8061
# expose range, env and regular port
# exp       8061        8080     8081    8083 8084  8085     8087       8090      8091      8092      8092     8093      8094   warn and ignore for both     8100/udp           8101/udp
EXPOSE "$EARLY_EXPOSE" "$PORT" 8081-8082 8083 "$X" $RANGE $RECURSIVE $ARG_PORT ${BRACES} "${LINE2}" $OVERLAP $DEFAULT $OVERRIDE $MISSING_OVERRIDE GARBAGE ${PORT_P}/${PROTO} ${RANGE_P}/udp

# shouldn't take into account in previous EXPOSE
# env $PORT should evaluate to 8080 there
ENV PORT 10

ENTRYPOINT ["./run.sh"]
